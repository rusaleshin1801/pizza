{"ast":null,"code":"import _toConsumableArray from\"/Users/a366/pizza/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/a366/pizza/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/a366/pizza/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/a366/pizza/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/a366/pizza/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import{useNavigate}from\"react-router-dom\";import qs from\"qs\";import{useSelector,useDispatch}from\"react-redux\";import{setCategoryId,setCurrentPage}from\"../redux/slices/filterSlice.ts\";import Categories from\"../componets/Categories.tsx\";import Sort from\"../componets/Sort.tsx\";import PizzaBlock from\"../componets/PizzaBlock/PizzaBlock.tsx\";import Skeleton from\"../componets/PizzaBlock/Skeleton.tsx\";import Pagination from\"../componets/Pagination/index.tsx\";import{fetchPizzas}from\"../redux/slices/pizzaClice\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useDispatch();var isSearch=React.useRef(false);var isMounted=React.useRef(false);var items=useSelector(function(state){return state.pizza.items;});var _useSelector=useSelector(function(state){return state.filterSlice;}),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;var _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),isLoading=_React$useState2[0],setIsLoading=_React$useState2[1];var onChangeCategory=React.useCallback(function(id){dispatch(setCategoryId(id));},[]);var onChangePage=function onChangePage(number){dispatch(setCurrentPage(number));};var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var sortBy,order,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setIsLoading(true);sortBy=sort.sortProperty.replace(\"-\",\"\");order=sort.sortProperty.includes(\"-\")?\"asc\":\"desc\";category=categoryId>0?\"category=\".concat(categoryId):\"\";search=searchValue?\"&search=\".concat(searchValue):\"\";try{dispatch(fetchPizzas({sortBy:sortBy,order:order,category:category,search:search,currentPage:currentPage}));}catch(error){alert(\"Ошибка при загрузке страницы\");}finally{setIsLoading(false);}window.scrollTo(0,0);case 7:case\"end\":return _context.stop();}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();// Если изменили парамметры и был первый рендрер\nReact.useEffect(function(){if(isMounted.current){var params={categoryId:categoryId>0?categoryId:null,sortProperty:sort.sortProperty,currentPage:currentPage};var queryString=qs.stringify(params,{skipNulls:true});navigate(\"?\".concat(queryString));}if(!window.location.search){dispatch(fetchPizzas());}},[categoryId,sort.sortProperty,currentPage]);// Если был первый рендер, то проверяем URL - параметры и сохряняем в редаксе\nReact.useEffect(function(){getPizzas();},[categoryId,sort.sortProperty,searchValue,currentPage]);// Если был первый рендер, то запрашиваем пиццы\nReact.useEffect(function(){isSearch.current=false;},[]);var pizzas=items.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});var skeletons=_toConsumableArray(new Array(6)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onClickCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:isLoading?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;// window.scrollTo(0, 0); при переходе на старницу, страница отоброжается на вверху\n// const [categoryId, setCategoryId] = useState(0);\n//   const [sortType, setSortType] = useState({\n//     name: \"популярности\",\n//     sort: \"rating\",\n//   }); вынесли useState из Категорий и Сорта\n// fetch(\n//   `https://63f9be5e473885d837d21495.mockapi.io/items?page=${currentPage}&limit=4&${category}&sortBy=${sortBy}&oreder=${order}${search}`\n// )\n//   .then((res) => res.json())\n//   .then((arr) => {\n//     setItems(arr);\n//     setIsLoading(false);\n//   });\n// axios\n//   .get(\n//     `https://63f9be5e473885d837d21495.mockapi.io/items?page=${currentPage}&limit=4&${category}&sortBy=${sortBy}&oreder=${order}&${search}`\n//   )\n//   .then((res) => {\n//     setItems(res.data);\n//     setIsLoading(false);\n//   });\n// с помощью свойства await сократил код, как на примере выше, убрал .then\n// try{}catch(){} - в try помещяем код, в catch - если ошибка! метод для\n//  отлавливания ошибок в синхронном коде","map":{"version":3,"names":["React","useNavigate","qs","useSelector","useDispatch","setCategoryId","setCurrentPage","Categories","Sort","PizzaBlock","Skeleton","Pagination","fetchPizzas","jsx","_jsx","jsxs","_jsxs","Home","navigate","dispatch","isSearch","useRef","isMounted","items","state","pizza","_useSelector","filterSlice","categoryId","sort","currentPage","searchValue","_React$useState","useState","_React$useState2","_slicedToArray","isLoading","setIsLoading","onChangeCategory","useCallback","id","onChangePage","number","getPizzas","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","sortBy","order","category","search","wrap","_callee$","_context","prev","next","sortProperty","replace","includes","concat","error","alert","window","scrollTo","stop","apply","arguments","useEffect","current","params","queryString","stringify","skipNulls","location","pizzas","map","obj","_objectSpread","skeletons","_toConsumableArray","Array","_","index","className","children","value","onClickCategory"],"sources":["/Users/a366/pizza/src/pages/Home.jsx"],"sourcesContent":["import React from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport qs from \"qs\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nimport { setCategoryId, setCurrentPage } from \"../redux/slices/filterSlice.ts\";\nimport Categories from \"../componets/Categories.tsx\";\nimport Sort from \"../componets/Sort.tsx\";\nimport PizzaBlock from \"../componets/PizzaBlock/PizzaBlock.tsx\";\nimport Skeleton from \"../componets/PizzaBlock/Skeleton.tsx\";\nimport Pagination from \"../componets/Pagination/index.tsx\";\n\nimport { fetchPizzas } from \"../redux/slices/pizzaClice\";\n\nconst Home = () => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const isSearch = React.useRef(false);\n  const isMounted = React.useRef(false);\n\n  const items = useSelector((state) => state.pizza.items);\n  const { categoryId, sort, currentPage, searchValue } = useSelector(\n    (state) => state.filterSlice\n  );\n\n  const [isLoading, setIsLoading] = React.useState(true);\n\n  const onChangeCategory = React.useCallback((id) => {\n    dispatch(setCategoryId(id));\n  }, []);\n\n  const onChangePage = (number) => {\n    dispatch(setCurrentPage(number));\n  };\n\n  const getPizzas = async () => {\n    setIsLoading(true);\n\n    const sortBy = sort.sortProperty.replace(\"-\", \"\");\n    const order = sort.sortProperty.includes(\"-\") ? \"asc\" : \"desc\";\n    const category = categoryId > 0 ? `category=${categoryId}` : \"\";\n    const search = searchValue ? `&search=${searchValue}` : \"\";\n\n    try {\n      dispatch(\n        fetchPizzas({\n          sortBy,\n          order,\n          category,\n          search,\n          currentPage,\n        })\n      );\n    } catch (error) {\n      alert(\"Ошибка при загрузке страницы\");\n    } finally {\n      setIsLoading(false);\n    }\n    window.scrollTo(0, 0);\n  };\n\n  // Если изменили парамметры и был первый рендрер\n  React.useEffect(() => {\n    if (isMounted.current) {\n      const params = {\n        categoryId: categoryId > 0 ? categoryId : null,\n        sortProperty: sort.sortProperty,\n        currentPage,\n      };\n\n      const queryString = qs.stringify(params, { skipNulls: true });\n\n      navigate(`?${queryString}`);\n    }\n\n    if (!window.location.search) {\n      dispatch(fetchPizzas());\n    }\n  }, [categoryId, sort.sortProperty, currentPage]);\n\n  // Если был первый рендер, то проверяем URL - параметры и сохряняем в редаксе\n  React.useEffect(() => {\n    getPizzas();\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  // Если был первый рендер, то запрашиваем пиццы\n  React.useEffect(() => {\n    isSearch.current = false;\n  }, []);\n\n  const pizzas = items.map((obj) => <PizzaBlock key={obj.id} {...obj} />);\n  const skeletons = [...new Array(6)].map((_, index) => (\n    <Skeleton key={index} />\n  ));\n\n  return (\n    <div className=\"container\">\n      <div className=\"content__top\">\n        <Categories value={categoryId} onClickCategory={onChangeCategory} />\n        <Sort value={sort} />\n      </div>\n      <h2 className=\"content__title\">Все пиццы</h2>\n      <div className=\"content__items\">{isLoading ? skeletons : pizzas}</div>\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\n    </div>\n  );\n};\n\nexport default Home;\n\n// window.scrollTo(0, 0); при переходе на старницу, страница отоброжается на вверху\n\n// const [categoryId, setCategoryId] = useState(0);\n//   const [sortType, setSortType] = useState({\n//     name: \"популярности\",\n//     sort: \"rating\",\n//   }); вынесли useState из Категорий и Сорта\n\n// fetch(\n//   `https://63f9be5e473885d837d21495.mockapi.io/items?page=${currentPage}&limit=4&${category}&sortBy=${sortBy}&oreder=${order}${search}`\n// )\n//   .then((res) => res.json())\n//   .then((arr) => {\n//     setItems(arr);\n//     setIsLoading(false);\n//   });\n\n// axios\n//   .get(\n//     `https://63f9be5e473885d837d21495.mockapi.io/items?page=${currentPage}&limit=4&${category}&sortBy=${sortBy}&oreder=${order}&${search}`\n//   )\n//   .then((res) => {\n//     setItems(res.data);\n//     setIsLoading(false);\n//   });\n\n// с помощью свойства await сократил код, как на примере выше, убрал .then\n\n// try{}catch(){} - в try помещяем код, в catch - если ошибка! метод для\n//  отлавливания ошибок в синхронном коде\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}